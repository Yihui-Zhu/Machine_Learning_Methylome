## Title: Machine learning analysis of whole-genome methylation data reveals novel prediction on tetrahydrofolate level in placenta tissue

### Abstract
Folic acid is an essential vitamin, especially for women who are pregnant or planning to be pregnant. It is the primary methyl donor for methylation reaction in one-carbon pathway which are required by DNA synthesis, repair and methylation. Prenatal vitamins, including folate can offer offspring protection by decreasing neural tube defaults. Lacking methyl donor can lead to abnormal gene methylation patterns which will increase the risk of developmental programming. 

Epigenetics is defined as stable modifications to nucleotides or chromosomes without alternations to the underlying DNA sequence. Epigenetics, especially DNA methylation of the major metabolic pathways at intrauterine development this critical window has been implicated with metabolic and neuronal developmental programming that related with various neurodevelopmental disorders. DNA methylation shows the variability during fetal and contains molecular memory with in utero experiences such as folic acid. 

Placenta tissue, usually discarded at birth, is a potentially rich source for studying DNA methylation patterns similar to oocytes and pre-implantation states of development. Placenta plays a crucial role in transferring nutrients, exchanging wastes and gas, and protecting the fetus from infections, which plays a vital role in embryo development and growth.

Currently, folic acid measurements are complex and expensive by metabolic measurement. Those measurements also variable by batches and instruments. This project investigated on multiple machine learning prediction models on folic acid levels with direct measurement in placenta by using placental DNA methylation on matched samples. Nearest neighbor model generated the best prediction rate, followed by random forest, decision tree and neural networks. All four models had high prediction accuracy on folate levels. 

### Materials and Methods
#### Placenta Methylation Data Collection
Placenta were collected from the Markers of Autism Risk in Babies: Learning Early Sign (MARBLES) 15 as a prospective longitudinal study. To obtain epigenomics profiles, whole genome bisulfite sequencing was done on 87 placenta samples and mapped to human genome using HiSeq X10 one two samples per lane. After trimming for the adaptor and other quality controls, percent methylation bed files that contained base specific methylation information were obtained with average 5x coverage per samples. Samples were randomly separated into training set (70 samples) and testing set (17 samples).

Window methylation files were extracted from WGBS data with 5 kb (kilo-base) non-overlapping sliding windows with at least 10 CpG sites covered and at least one read in all samples. Windows with zero reads were removed. After filtering for the requirement, there are 537,545 windows remained for future analysis. There were 43,256 windows with enough coverage in chromosome 1. 

#### Folate Acid Data Collection
From the matching 87 samples, lab measured folate acid levels directly from placenta tissue by using metabolite measures. Four components were obtained, tetrahydrofolate (THF), 5,10-methyenylTHF, 5-formylTHF and folic acid belonged to one-carbon pathway. This pathway provides link from folate acid to methyl-donor 2,6. 

#### Data Preprocessing
Raw window methylation data was scaled into normal distribution with mean 0 and standard derivation 1. For folate acid data, density plot and Q-Q plot were used to check the normality. After transformation, both THF and 5-formylTHF were fit with normal distribution with high correlation with each other (p = 1.07E-9). Selected THF as the predicted outcome for this study.

#### Prediction Models
Both non-neural network and neural network machine learning model were used in this study. For non-neural network models, six models including linear regression, nearest neighbors, support vector machine (SVM), adaboost, gaussian process, decision treat and random forest with different parameters were tested. 
In neural network model, rectified linear unit (ReLU) was used as activation function. Cost function was defined using the reduced mean of L2 regularization between forward propagation output and the true labels. Various regulations were done, including number of layers, dropout rates, learning rate, mini-batch size. Two model quality scores were measured to monitor the prediction model behaviors based on continuous traits, THF levels, R2 score and accuracy. R2 score computed the coefficient of determination to measure the observed outcomes are replicated by the model. Accuracy was defined as the number of predicted outcomes located inside the 95% confidence intervals of observed outcomes. 

### Results
#### Raw window methylation 
Different types of non-neural network models were first attempted with raw methylation at 537,545 windows and tetrahydrofolate level. Different types of generalized linear models were attempted, including ridge, lasso and elastic net. The best R2 score was 0.09. Nearest neighbor model had the highest performance with 0.392 R2 score, with the number of neighbors equal to 2 and the power parameter equal to 7 (Figure 1). SVM gave prediction R2 score 0.09. Adaboost has predicted R2 score -0.12. Gaussian process predicted almost a flat line with R2 score 0.07. The best performance decision tree made is R2 score at -0.7, with changing into different parameters. Stochastics graduate descent performed poor behaviors with most of testing samples predict the opposite direction. Random forest gave R2 score at 0.2 at max depth of 2 and random state with 1 (Figure 2A). First neural network was performed on three hidden layers with training set R2 score at 0.02 and testing set R2 score at -0.07 (parameters, w1 = [25, 537594], w2 = [12, 25], w3 = [1, 12]). For the raw methylation and tetrahydrofolate level, the behaviors of the prediction models were as following: nearest neighbor > random forest > linear regression = SVM > gaussian process > neural network > adaboost > decision tree with the best behavior model’s R2 score at 0.392 (Figure 1). 

#### Scaled window methylation
Followed by the raw dataset, the scaled dataset was also approached for both methylation 537,545 windows and tetrahydrofolate level. Using this approach, linear regression performed R2 score at 0.12. For SVM, the best performance was from linear kernel with R2 score at 0.12. Nearest neighbor model generated R2 score at 0.112. Adaboost and decision tree all predict R2 score less than 0. Random forest best performance R2 score was 0.2 with the maximum depth at 2 and random state at 1 (Figure 2B). With using three hidden layers neural network, the training set R2 score had reached 0.99 with the resting set R2 score at -0.34 (parameters, w1 = [25, 537594], w2 = [12, 25], w3 = [1, 12]). The accuracy of neural network model is 88%. For the scaled data, the prediction models’ behaviors were as below: random forest > linear regression = SVM > nearest neighbor > neural network > adaboost > decision tree with the best behavior model’s R2 score at 0.2 (Figure 2B). 

#### Chromosome 1 scaled window methylation
When using the chromosome 1 scaled methylation data on 43,256 windows, the best prediction model was decision tree with R2 score at 0.15 (Figure 3). Linear regression model reached R2 score at 0.08. nearest neighbors had negative R2 score at -0.16. SVM best behavior’s R2 score was at 0.09. Adaboost model had R2 score at -0.07. Gaussian process test with R2 score at 0.08. For random forest the best model R2 score was at -0.07. For 3-hidden layer neural network, the best model had training set accuracy at 0.9 and the testing set accuracy at 0.7 but low R2 score on both training set (0.61) and testing sets (-0.28) (parameters, w1 = [255, 43255], w2 = [55, 43255], w3 = [1, 55]). To sum up for using chromosome 1 scaled methylation as features for prediction model, the behaviors were as following: decision tree > SVM > linear regression = gaussian process > adaboost = random forest > nearest neighbor > neural network with the best behavior models’ R2 score at 0.15 (Figure 3). 

#### Regularization: PCA 
Principle component analysis (PCA) was performed to condense the number of features (chromosome 1 window methylation) to avoid overfitting the neural network model. The first top 100 PCs (principle components) were maintained and tested for neural network analysis. With those 100 PCs, the training set R2 score reached 0.99 with accuracy at 99%, but the testing set R2 score is at -0.999 with accuracy 6%. Besides that, maintaining PCs illustrated 95% confidence interval was also approached. Using 95% confidence interval, the top 64 PCs were selected for following analysis. Using this approach, the training set was slightly worse with R2 score at 0.96 and accuracy at 98% and the testing set R2 score was slightly better with R2 score at -0.998 with 29% accuracy. Overall, using the PCA to trim down the number of features slightly improved neural network behavior, but still over fitting still existence.

#### Regularization: dropout rate
From previous analysis and comparison, using all chromosome 537,545 windows methylation and PCA reduced feature gave better performance. To add regularization component to the neural network model, dropout rate was used to add penalty to original neural network model to minimize the effect of overfitting the model. In the 3-layer neural network model, 60% dropout rate was added to the first two layer of the neural network model. The training set went worse and the testing set went slightly better with the R2 score still remained negative. After that, increasing dropout rate to 80%. The training set got worse and testing got better. Using 10% dropout rate, the prediction rate was very similar to the original model. With 90% dropout rate, the model was close to random prediction. With adding dropout rate, there were less overfitting but the R2 score and accuracy for testing set was still remained similar. 
  
#### Regularization: different hidden layers
Decreasing the number of hidden layers approach were also attempted with using the top 64 features from 537,545 windows methylation values. When changed into two layers neural network, training set R2 score at 0.9999 with accuracy 100% (parameters, w1 = [25, 64], w2 = [1 25]). But testing set R2 score was still at -0.98 with accuracy at 35%. After adding 20% dropout rate, the model was worse than original model. From here, neural network was trimmed down to one layer with the same tip 64 feature. The testing set R2 score was at 0.97 and testing set R2 score at 0.12 with both training and testing set 100% accuracy. With adding 10% dropout rate training set R2 score was at 0.958 with 100% accuracy with testing set R2 score at 0.1069 at 100% accuracy. Instead of using the top 64 PCs as features, all 537,545 windows methylation was used to test the one-layer neural network model. With this method, both training and testing set was worse than using top 64 PCs. From different layer test, neural network behavior one layer > two layers > three layers. 

#### Regularization: number of PCs
Different number of PCs with different dropout rates on one-layer neural network were also attempted. Using the top 70 PCs, the model’s training set R2 score was at 1 with 100% accuracy and testing set R2 score was at 0.107 with 100% accuracy. When using this top 70 PCs and adding 20% dropout rate, the model’s training set R2 score was at 0.7 and 95 % accuracy with testing set remained the same. Using the top 50 PCs, training set R2 score was 0.812 with 100% accuracy and testing set R2 score was at 0.114 with 100% accuracy. With adding dropout rate, this model turned poor behavior. When maintained the top 30 PCs, training set R2 score at 0.512 with 100% accuracy and testing set R2 score at 0.14 with 100% accuracy (Figure 4). When adding 20% dropout rate, the model remained the same. Using the top 15 PCs, training set R2 score was at 0.38 with 100% accuracy and testing set R2 score was at 0.128 with 100% accuracy. Switching to use the top 12 PCs, training set R2 score was at 0.347 with 100% accuracy and testing set R2 score at 0.132 with 100% accuracy. Using the top 10 PCs, training set R2 score was at 0.272 with 100% accuracy and testing set R2 score at 0.132 with 100% accuracy. To extreme case with using top 2PCs, training set R2 score at 0.04 and testing set R2 score at -0.02. For different PCs and dropout rate test, top 30 PCs > 10 PCs > 5 PCs > 12 PCs > 15 PCs > 50 PCs > 70 PCs > 2 PCs with the best behavior models’ R2 score at 0.14 (Figure 4). 

### Discussion 
The best prediction model is nearest neighbor model using all chromosome window methylation values with the number of neighbors equal to 2 and the power parameter equal to 7, which reached the highest R2 score at 0.392 (Figure 1). The second to the best is random forest model in either raw or scaled window methylation value with R2 score at 0.207 (Figure 2A, 2B). Decision tree model with using chromosome 1 scaled window methylation gave the third best model with R2 score at 0.15 (Figure 3). The fourth model is one-layer neural network model with using the top 30 PCs gave R2 score at 0.14 (Figure 4). All those top four models gave 100% accuracy.  

Overall the raw methylation gave better performance than using scaled data and just chromosome 1 methylation value. The non-neural network model gave better performance than neural network giving small sample size for both training set (n=70) and testing set (n=17). Random forest model had the same behavior between raw and scaled methylation value and performed better than linear regression and gave pretty good prediction rate. Nearest neighbor’s results were very variable depended on the input data. Gaussian process, adaboost and decision tree were not predicting accurately with continuous trait regardless of the data type. 

For neural network, different layers, dropout rate, PCs were tested. Based on different dropout rate testing, the higher the dropout rate, the lower bias between training and testing set, R2 score were closed together between training and testing set. But the rate training set accuracy decreased was more rapidly than the increasing testing set accuracy with increasing dropout rate. For different number of layers in neural network model, results from three layers to two layers till one-layer neural network model showed the lower number of hidden layers the better neural network model performed. From testing different PCs, lower PCA dimension positive associated with increasing testing set R2 score. With adding penalty rate, there was a rapidly decrease on training set R2 score with small increasing on testing set R2 score. The best neural network model was one-layer model using the top 30 PCs without dropout rate, which gave R2 score at 0.14. 

For this project, there were two challenging parts. Defining the model behavior was difficult. It is hard to define whether a model was good or not with continuous traits. R2 score was not reflecting the whole behavior of the model. Some prediction values compared with extreme real value can strongly affect R2 score. The accuracy score method was defined due to R2 score biased reason with testing the whether the prediction value was located within 95% confidence interval with the real value. Future study could be done on using different accuracy methods. Besides that, 5kb windows seems too large to observe continuous methylation change. Currently, there were not enough resolution to look at single CpG site. Apart from that, sample size was small and some samples were very extreme. Methylation changes were smaller than tetrahydrofolate change. There were still more research needs to be done. 

In conclusion, there was the first-time using machine learning model predict tetrahydrofolate using methylation data from whole genome study. There were few pretty accurate models generated and direction and different types of both non-neural and neural network models. These results therefore provide some initiative methods and ideas on using methylation to predict continuous traits that are expected to be useful for future methylation studies. 
